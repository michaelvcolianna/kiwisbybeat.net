---
import { getCollection } from 'astro:content'
import BaseLayout from '@layouts/BaseLayout.astro'
import HomePage from '@components/HomePage.astro'
import SeriesPage from '@components/SeriesPage.astro'
import ComicPage from '@components/ComicPage.astro'

export async function getStaticPaths() {
  const posts = await getCollection('posts')

  return posts.map(post => ({
    params: { slug: post.slug === 'index' ? '/' : post.slug }, props: { post }
  }))
}

const { post } = Astro.props;
const { Content } = await post.render()

const Components = {
  home: HomePage,
  chapter: SeriesPage,
  docs: ComicPage
}

const pageType = post.data.series && post.data.set ? 'docs' : (post.data.series ? 'chapter' : 'home')
const LayoutComponent = Components[pageType]

// @todo Rework this for the updated pageType & not using React/Gatsby head
/*
  let description, title, url
  let image = frontmatter.cover ? frontmatter.cover.publicURL : null

  if(pageType === 'chapter') {
    description = frontmatter.description || `The ${frontmatter.title} series on Kiwis by Beat!`
    title = frontmatter.title
    url = urlFromPath(pagePath)
  }

  if(pageType === 'docs') {
    description = `${frontmatter.title} of the ${parent.frontmatter.title} series on Kiwis by Beat!`
    title = `${parent.frontmatter.title} â€“ ${frontmatter.title}`
    url = pageUrl(parent.fileAbsolutePath, pagePath)

    if(parent.frontmatter.cover) {
      image = parent.frontmatter.cover.publicURL
    }
  }

*/
---

<BaseLayout frontmatter={post.data}>
  <LayoutComponent post={post}>
    <Content />
  </LayoutComponent>
</BaseLayout>
